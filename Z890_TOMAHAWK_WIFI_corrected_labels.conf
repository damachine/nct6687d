# Micro-Star International Co., Ltd.
# MSI MAG Z890 TOMAHAWK WIFI - Korrigierte Sensor-Konfiguration
# Intel Z890 Chipset with NCT6687D/NCT6687 Super-I/O
# Erstellt für Arch Linux mit nct6687d Treiber
#
# Diese Konfiguration berücksichtigt die tatsächlichen NCT6687 Treiber-Labels
# und die Hardware-Zuordnung des MSI Z890 TOMAHAWK WIFI Motherboards.
# 
# Installation:
# 1. sudo cp Z890_TOMAHAWK_WIFI_corrected_labels.conf /etc/sensors.d/Z890_TOMAHAWK_WIFI.conf
# 2. echo "nct6687 manual=1" | sudo tee /etc/modules-load.d/nct6687.conf
# 3. sudo modprobe -r nct6687 && sudo modprobe nct6687 manual=1
# 4. sudo sensors -s && sensors
#
# Anpassung: Führen Sie bash analyze_z890_hardware_mapping.sh aus für Hardware-spezifische Zuordnung

chip "nct6687-*"
    # Spannungen - Intel Z890 spezifische Zuordnung
    # Diese Labels entsprechen den Standard NCT6687 Voltage-Definitionen
    label in0         "+12V"          # 12V Hauptversorgung (Multiplier: 12)
    label in1         "+5V"           # 5V Standby (Multiplier: 5)
    label in2         "CPU Soc"       # CPU SoC Spannung (NCT6687 Standard)
    label in3         "DRAM"          # Arbeitsspeicher-Spannung (Multiplier: 2)
    label in4         "CPU Vcore"     # CPU Kernspannung (NCT6687 Standard)
    label in5         "Chipset"       # Chipsatz-Spannung (NCT6687 Standard)
    label in6         "CPU SA"        # CPU System Agent (NCT6687 Standard)
    label in7         "Voltage #2"    # Zusätzliche Spannung (NCT6687 Standard)
    label in8         "AVCC3"         # AVCC3 Spannung (NCT6687 Standard)
    label in9         "CPU 1P8"       # CPU 1.8V (NCT6687 Standard)
    label in10        "CPU VDDP"      # CPU VDDP (NCT6687 Standard)
    label in11        "+3.3V"         # 3.3V Rail (NCT6687 Standard)
    label in12        "AVSB"          # Auxiliary Standby (NCT6687 Standard)
    label in13        "VBat"          # CMOS Batterie (NCT6687 Standard)

    # Temperaturen - NCT6687 Standard-Labels für Z890
    # Diese Labels entsprechen den im nct6687.c definierten Standard-Labels
    label temp1       "CPU"           # CPU Temperatur (NCT6687 Standard)
    label temp2       "System"        # System-Temperatur (NCT6687 Standard)
    label temp3       "VRM MOS"       # Spannungsregler (NCT6687 Standard)
    label temp4       "PCH"           # Platform Controller Hub (NCT6687 Standard)
    label temp5       "CPU Socket"    # CPU Sockel (NCT6687 Standard)
    label temp6       "PCIe x1"       # PCIe Slot (NCT6687 Standard)
    label temp7       "M2_1"          # M.2 Slot 1 (NCT6687 Standard)

    # Lüfter - NCT6687 Standard-Labels (aus nct6687.c)
    # WICHTIG: Diese Labels entsprechen den fest im Treiber definierten Labels
    # Die tatsächliche Hardware-Zuordnung kann abweichen!
    label fan1        "CPU Fan"       # CPU Lüfter (NCT6687 Standard)
    label fan2        "Pump Fan"      # Pumpen-Lüfter (NCT6687 Standard)
    label fan3        "System Fan #1" # System Lüfter 1 (NCT6687 Standard)
    label fan4        "System Fan #2" # System Lüfter 2 (NCT6687 Standard)
    label fan5        "System Fan #3" # System Lüfter 3 (NCT6687 Standard)
    label fan6        "System Fan #4" # System Lüfter 4 (NCT6687 Standard)
    label fan7        "System Fan #5" # System Lüfter 5 (NCT6687 Standard)
    label fan8        "System Fan #6" # System Lüfter 6 (NCT6687 Standard)

    # PWM-Kontrollen - Entsprechend den Lüfter-Labels
    label pwm1        "CPU Fan PWM"
    label pwm2        "Pump Fan PWM"
    label pwm3        "System Fan #1 PWM"
    label pwm4        "System Fan #2 PWM"
    label pwm5        "System Fan #3 PWM"
    label pwm6        "System Fan #4 PWM"
    label pwm7        "System Fan #5 PWM"
    label pwm8        "System Fan #6 PWM"

    # Spannungs-Multiplier (basierend auf NCT6687 Standard-Definitionen)
    compute in0       (@ * 12), (@ / 12)    # +12V (Standard NCT6687)
    compute in1       (@ * 5), (@ / 5)      # +5V (Standard NCT6687)
    compute in3       (@ * 2), (@ / 2)      # DRAM (Standard NCT6687)
    # Andere Spannungen verwenden normalerweise 1:1 Multiplier
    # compute in11      (@ * 1), (@ / 1)    # +3.3V falls nötig

    # Ignoriere unzuverlässige oder nicht verwendete Sensoren
    # Diese können je nach tatsächlicher Hardware-Konfiguration angepasst werden
    # ignore in7        # Voltage #2 falls nicht verwendet
    # ignore in8        # AVCC3 falls nicht zuverlässig
    # ignore in9        # CPU 1P8 falls nicht benötigt
    # ignore in10       # CPU VDDP falls nicht benötigt
    # ignore in12       # AVSB falls nicht benötigt
    # ignore in13       # VBat falls nicht zuverlässig
    # ignore temp6      # PCIe x1 falls kein Sensor
    # ignore temp7      # M2_1 falls kein Sensor

    # Temperatur-Limits (optional, konservative Werte)
    set temp1_max     85              # CPU max
    set temp1_crit    95              # CPU kritisch
    set temp3_max     80              # VRM max
    set temp4_max     70              # PCH max

    # Lüfter-Mindestdrehzahlen (optional)
    # Nur für tatsächlich angeschlossene Lüfter aktivieren
    set fan1_min      300             # CPU Lüfter min
    set fan2_min      300             # Pumpe min
    set fan3_min      200             # System Lüfter min
    set fan4_min      200
    set fan5_min      200
    set fan6_min      200
    set fan7_min      200
    set fan8_min      200

# WICHTIGE HINWEISE für MSI MAG Z890 TOMAHAWK WIFI:
#
# 1. HARDWARE-ZUORDNUNG:
#    Die obigen Labels entsprechen den NCT6687 Treiber-Standards.
#    Die tatsächliche Zuordnung zu den Motherboard-Anschlüssen kann abweichen:
#    
#    NCT6687 Label     → Möglicher MSI Z890 Anschluss
#    fan1 "CPU Fan"    → CPU_FAN1 (Hauptprozessor)
#    fan2 "Pump Fan"   → PUMP_FAN1 oder CPU_OPT1
#    fan3 "System Fan #1" → SYS_FAN1
#    fan4 "System Fan #2" → SYS_FAN2
#    fan5 "System Fan #3" → SYS_FAN3
#    fan6 "System Fan #4" → SYS_FAN4
#    fan7 "System Fan #5" → SYS_FAN5
#    fan8 "System Fan #6" → CPU_OPT1 oder zusätzlicher Anschluss
#
# 2. DIAGNOSE UND ANPASSUNG:
#    Führen Sie folgende Scripts aus für korrekte Zuordnung:
#    - bash analyze_z890_hardware_mapping.sh (Hardware-Analyse)
#    - bash debug_nct6687_registers.sh (Register-Debug)
#    - bash create_corrected_z890_config.sh (Automatische Korrektur)
#
# 3. BIOS-VERGLEICH:
#    Vergleichen Sie die sensors-Ausgabe mit den BIOS/UEFI Hardware Monitor Werten
#    um die korrekte Zuordnung zu bestätigen.
#
# 4. TROUBLESHOOTING:
#    Bei Problemen mit der Lüfter-Erkennung:
#    - BIOS Hardware Monitor: Enabled
#    - Smart Fan Control: Enabled
#    - manual=1 Parameter verwenden
#    - force=1 Parameter testen
#
# 5. ANPASSUNG:
#    Diese Konfiguration kann als Basis verwendet und dann entsprechend
#    der tatsächlichen Hardware-Zuordnung angepasst werden.
